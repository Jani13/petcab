<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.petcab.work.review.model.dao.ReviewDao">
	<sql id="ReviewListSql">
		SELECT  R.REVIEW_NO,
				R.TITLE,
				M.USER_ID,
				R.STAR_NO,
				R.POST_DATE,
				R.STATUS,
				R.VIEW_NO
			FROM REVIEW R
			JOIN MEMBER M ON (R.USER_NO = M.USER_NO)
	</sql>
	
	<resultMap type="Review" id="reviewResultMap">
		<id property="reviewNo" column="REVIEW_NO"/>
		<result property="userNo" column="USER_NO"/>
		<result property="callNo" column="CALL_NO"/>
		<result property="title" column="TITLE"/>
		<result property="content" column="CONTENT"/>
		<result property="postDate" column="POST_DATE"/>	
		<result property="editDate" column="EDIT_DATE"/>	
		<result property="viewNo" column="VIEW_NO"/>
		<result property="callType" column="CALL_TYPE"/>
		<result property="starNo" column="STAR_NO"/>
		<result property="groupNo" column="GROUP_NO"/>
		<result property="groupSeq" column="GROUP_SEQ"/>
		<result property="depth" column="DEPTH"/>
		<result property="status" column="STATUS"/>
	</resultMap>
	
	<select id="selectReviewList" parameterType="map" resultMap="reivewResultMap">
		<include refid="ReviewListSql"></include>
		ORDER BY R.REVIEW_NO DESC
	</select>
	
	<select id="selectCount" parameterType="map" resultType="_int">
		SELECT COUNT(*)
		FROM REVIEW
	</select>
	
	<insert id="insertReview" parameterType="map"
  		useGeneratedKeys="true" keyProperty="ReviewNo" keyColumn="REVIEW_NO">
  		
  		INSERT INTO REVIEW 
  		VALUES(
  			SEQ_REVIEW_NO.NEXTVAL,
  			#{callType},
  			#{starNo},
  			#{title},
  			#{content},
  			DEFAULT,
  			DEFAULT,
  			DEFAULT,
  			DEFAULT,
  			DEFAULT,
  			DEFAULT,
  			DEFAULT,
  			DEFAULT,
  			DEFAULT
 		)
  	</insert>
  	
  	<update id="updateReview" parameterType="Review">
  		UPDATE REIVEW
  		SET
  			STAR_NO=#{starNo},
  			TITLE=#{title},
  			CONTENT=#{content},
  			EDIT_DATE=SYSDATE
  		WHERE
  			REIVEW_NO=#{reviewNo}
  	</update>

</mapper>
